#!/usr/bin/env bash
# Monero Daemon Functions
daemon_start_Template()
{
	missing_Monerod
	if pgrep monerod &>/dev/null ; then
        $bred; echo "Monero daemon already detected..." ;$off
    else
		missing_config_Monerod
		$bred; echo "Starting Monero daemon..." ;$off
		COMMANDS
		error_Exit "Could not start monerod"
	fi
}

daemon_stop_Template()
{
	if pgrep monerod &>/dev/null ; then
		COMMANDS
	else
		$white; echo -n "Monero daemon: "
		$bred; echo "not online" ;$off
	fi
}

daemon_Start()
{
	COMMANDS()
	{
		missing_systemd_Monerod
		sudo systemctl start monero-bash-monerod
	}
	daemon_start_Template
}

daemon_Stop()
{
	COMMANDS()
	{
		$ired; echo "Stopping Monero daemon gracefully..." ;$off
		"$binMonero/monerod" --data-dir "$DATA_PATH" --config-file "$config/monerod.conf" exit
		for i in {1..30} ;do
			if [[ "$i" = "30" ]]; then
				print_Error "Monero daemon not responding, killing..."
				daemon_Kill
			fi
			if pgrep monerod &>/dev/null ;then
				echo -n "."
			else
				echo "."
				break
			fi
			sleep 1
		done
	}
	daemon_stop_Template
}

daemon_Kill()
{
	COMMANDS()
	{
		$ired; echo "Killing Monero daemon..."
		killall monerod
		if [[ $? = 0 ]]; then
			$white; echo "Monero daemon killed"
		else
			print_Error "Monero daemon was not killed"
		fi
	}
	daemon_stop_Template
}

daemon_start_Full()
{
	COMMANDS(){ "$binMonero/monerod" --data-dir "$DATA_PATH" --config-file "$config/monerod.conf --zmq-pub tcp://127.0.0.1:18083" ;}
	daemon_start_Template
}
